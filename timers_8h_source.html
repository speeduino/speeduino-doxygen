<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Speeduino: speeduino/timers.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="speeduino_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Speeduino
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9dd927a2de2c3597e2b3a7dd174a4cd6.html">speeduino</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">timers.h</div></div>
</div><!--header-->
<div class="contents">
<a href="timers_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">/*</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">NOTE - This file and it&#39;s associated functions need a CLEARER NAME</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"></span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">//Purpose</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">We&#39;re implementing a lower frequency interrupt loop to perform calculations that are needed less often, some of which depend on time having passed (delta/time) to be meaningful.</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"></span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"></span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">//Technical</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">Timer2 is only 8bit so we are setting the prescaler to 128 to get the most out of it. This means that the counter increments every 0.008ms and the overflow at 256 will be after 2.048ms</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">Max Period = (Prescale)*(1/Frequency)*(2^8)</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">(See arduinomega.blogspot.com.au/2011/05/timer2-and-overflow-interrupt-lets-get.html)</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"></span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">We&#39;re after a 1ms interval so we&#39;ll need 131 intervals to reach this ( 1ms / 0.008ms per tick = 125).</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">Hence we will preload the timer with 131 cycles to leave 125 until overflow (1ms).</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"></span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">*/</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#ifndef TIMERS_H</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#define TIMERS_H</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="timers_8h.html#a6a188777b3fa3f7f6e93124fee711846">   24</a></span><span class="preprocessor">#define SET_COMPARE(compare, value) compare = (COMPARE_TYPE)(value) </span><span class="comment">// It is important that we cast this to the actual overflow limit of the timer. The compare variables type can be bigger than the timer overflow.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="timers_8h.html#a875ca956caff6c349e6bac8de2248801">   26</a></span><span class="preprocessor">#define TACHO_PULSE_HIGH() *tach_pin_port |= (tach_pin_mask)</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="timers_8h.html#ae960c1b872e48dfd99082e08af16cb07">   27</a></span><span class="preprocessor">#define TACHO_PULSE_LOW() *tach_pin_port &amp;= ~(tach_pin_mask)</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9a33cf1d8ef1d06ee698a7fabf40eb3a7f">   28</a></span><span class="keyword">enum</span> <a class="code hl_enumeration" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9">TachoOutputStatus</a> {<a class="code hl_enumvalue" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9aa9724c8d010507da08eeeace81d14508">TACHO_INACTIVE</a>, <a class="code hl_enumvalue" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9a6564f2f3e15be06b670547bbcaaf0798">READY</a>, <a class="code hl_enumvalue" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a>}; <span class="comment">//The 3 statuses that the tacho output pulse can have. NOTE: Cannot just use &#39;INACTIVE&#39; as this is already defined within the Teensy Libs</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">extern</span> <span class="keyword">volatile</span> <a class="code hl_enumeration" href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9">TachoOutputStatus</a> <a class="code hl_variable" href="timers_8h.html#a1406c2c99a043c02419c75026a3cbd2d">tachoOutputFlag</a>;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code hl_variable" href="timers_8h.html#a3d0f2e3bfd863c334304ebbea7d91777">tachoSweepEnabled</a>;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">extern</span> <span class="keyword">volatile</span> uint16_t <a class="code hl_variable" href="timers_8h.html#a3150a23925b1ff6630dfbe130fa69255">tachoSweepIncr</a>;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="timers_8h.html#ad1742544eda890463df786f92457bf20">   34</a></span><span class="preprocessor">#define TACHO_SWEEP_TIME_MS 1500</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno"><a class="line" href="timers_8h.html#aa364fe1fc2c2c32eafe39fc9a6d1384e">   35</a></span><span class="preprocessor">#define TACHO_SWEEP_RAMP_MS (TACHO_SWEEP_TIME_MS * 2 / 3)</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="timers_8h.html#a98c842b52ffe344288b6e38b12417baa">   36</a></span><span class="preprocessor">#define MS_PER_SEC  1000</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="timers_8h.html#ad9eeb05c018b7581903e860d16dd8df3">dwellLimit_uS</a>;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#if defined (CORE_TEENSY)</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>  <span class="keyword">extern</span> IntervalTimer lowResTimer;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="timers_8cpp.html#afd0a7412c083cf45e1bb1bf7c3fa8d0f">oneMSInterval</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#elif defined (ARDUINO_ARCH_STM32)</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="timers_8cpp.html#afd0a7412c083cf45e1bb1bf7c3fa8d0f">oneMSInterval</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keywordtype">void</span> <a class="code hl_function" href="timers_8h.html#a82d103c1270ab099efd96deda93d4dc1">initialiseTimers</a>(<span class="keywordtype">void</span>);</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#endif </span><span class="comment">// TIMERS_H</span></div>
<div class="ttc" id="aglobals_8h_html"><div class="ttname"><a href="globals_8h.html">globals.h</a></div></div>
<div class="ttc" id="atimers_8cpp_html_afd0a7412c083cf45e1bb1bf7c3fa8d0f"><div class="ttname"><a href="timers_8cpp.html#afd0a7412c083cf45e1bb1bf7c3fa8d0f">oneMSInterval</a></div><div class="ttdeci">void oneMSInterval(void)</div><div class="ttdef"><b>Definition:</b> timers.cpp:74</div></div>
<div class="ttc" id="atimers_8h_html_a1406c2c99a043c02419c75026a3cbd2d"><div class="ttname"><a href="timers_8h.html#a1406c2c99a043c02419c75026a3cbd2d">tachoOutputFlag</a></div><div class="ttdeci">volatile TachoOutputStatus tachoOutputFlag</div><div class="ttdef"><b>Definition:</b> timers.cpp:39</div></div>
<div class="ttc" id="atimers_8h_html_a3150a23925b1ff6630dfbe130fa69255"><div class="ttname"><a href="timers_8h.html#a3150a23925b1ff6630dfbe130fa69255">tachoSweepIncr</a></div><div class="ttdeci">volatile uint16_t tachoSweepIncr</div><div class="ttdef"><b>Definition:</b> timers.cpp:40</div></div>
<div class="ttc" id="atimers_8h_html_a3d0f2e3bfd863c334304ebbea7d91777"><div class="ttname"><a href="timers_8h.html#a3d0f2e3bfd863c334304ebbea7d91777">tachoSweepEnabled</a></div><div class="ttdeci">volatile bool tachoSweepEnabled</div></div>
<div class="ttc" id="atimers_8h_html_a82d103c1270ab099efd96deda93d4dc1"><div class="ttname"><a href="timers_8h.html#a82d103c1270ab099efd96deda93d4dc1">initialiseTimers</a></div><div class="ttdeci">void initialiseTimers(void)</div><div class="ttdef"><b>Definition:</b> timers.cpp:49</div></div>
<div class="ttc" id="atimers_8h_html_a8c08c47b167f96f6e2921d2846a575d9"><div class="ttname"><a href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9">TachoOutputStatus</a></div><div class="ttdeci">TachoOutputStatus</div><div class="ttdef"><b>Definition:</b> timers.h:28</div></div>
<div class="ttc" id="atimers_8h_html_a8c08c47b167f96f6e2921d2846a575d9a33cf1d8ef1d06ee698a7fabf40eb3a7f"><div class="ttname"><a href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9a33cf1d8ef1d06ee698a7fabf40eb3a7f">ACTIVE</a></div><div class="ttdeci">@ ACTIVE</div><div class="ttdef"><b>Definition:</b> timers.h:28</div></div>
<div class="ttc" id="atimers_8h_html_a8c08c47b167f96f6e2921d2846a575d9a6564f2f3e15be06b670547bbcaaf0798"><div class="ttname"><a href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9a6564f2f3e15be06b670547bbcaaf0798">READY</a></div><div class="ttdeci">@ READY</div><div class="ttdef"><b>Definition:</b> timers.h:28</div></div>
<div class="ttc" id="atimers_8h_html_a8c08c47b167f96f6e2921d2846a575d9aa9724c8d010507da08eeeace81d14508"><div class="ttname"><a href="timers_8h.html#a8c08c47b167f96f6e2921d2846a575d9aa9724c8d010507da08eeeace81d14508">TACHO_INACTIVE</a></div><div class="ttdeci">@ TACHO_INACTIVE</div><div class="ttdef"><b>Definition:</b> timers.h:28</div></div>
<div class="ttc" id="atimers_8h_html_ad9eeb05c018b7581903e860d16dd8df3"><div class="ttname"><a href="timers_8h.html#ad9eeb05c018b7581903e860d16dd8df3">dwellLimit_uS</a></div><div class="ttdeci">volatile unsigned int dwellLimit_uS</div><div class="ttdef"><b>Definition:</b> timers.cpp:36</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Feb 3 2024 05:55:34 for Speeduino by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
